
R version 2.5.0 (2007-04-23)
Copyright (C) 2007 The R Foundation for Statistical Computing
ISBN 3-900051-07-0

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ##############################
> ## Datasets of Rob Koehorst, Bart van Oort, 
> ## Sergey Laptenok, Ton Visser and Herbert van Amerongen
> ## 
> ##
> ## The below commands repeat the case study in spectral 
> ## modeling in the paper  "TIMP: an R package for 
> ## modeling multi-way spectroscopic measurements", 
> ## Mullen and van Stokkum, submitted to the 
> ## Journal of Statistical Software. 
> ##
> ## Note that the examples require the package TIMP and 
> ## use of R version 2.5 or higher. 
> ##############################
> 
> require(TIMP)
Loading required package: TIMP
Loading required package: tcltk
Loading Tcl/Tk interface ... done
Loading required package: vcd
Loading required package: MASS
Loading required package: grid
Loading required package: colorspace
Loading required package: fields
fields is loaded use help(fields) for an overview of this library
Loading required package: gplots
Loading required package: gtools
Loading required package: gdata

Attaching package: 'gplots'


	The following object(s) are masked from package:stats :

	 lowess 

Loading required package: splines
[1] TRUE
> psi_1 <- readData("psitspec.txt")
Read 1 item
Read 181063 items
> 
> psi_1_full <-preProcess(psi_1, sel_time=c(178, 478), 
+ sel_lambda_ab = c(440, 640))
> 
> psi_1_sampled <- preProcess(psi_1, sel_time=c(178, 478), 
+ sel_lambda_ab = c(440, 640), sample_time=5)
> 
> ##############################
> ## linear time dependence of spectral parameters
> ##############################
> 
> model_polylin <- initModel(mod_type = "spec", 
+ specpar=list(c(20000,3100,-.3) ), specdisp = TRUE,
+ specdispindex = list(c(1,1), c(1,2), c(1,3)),
+ specdisppar=list(c(-2000),c(1), c(.2)),
+ specref=53, specfun="gaus",  
+ iter=1, nupow=5, makeps="badan_lin", 
+ title = "Linear" )
> 
> res_polylin <- fitModel(data = list(psi_1_sampled), 
+ modspec = list(model_polylin), 
+ opt=specopt(iter=7, linrange = 20,
+ makeps = "polylin", nospectra = TRUE, 
+ selectedspectra = seq(1, psi_1_sampled@nt, by=7),
+ residplot = TRUE, 
+ xlab = "time", ylab = "wavelength"))
30676722820 :  -2000.0     1.0     0.2 20000.0  3100.0    -0.3 
  It.   1, fac=           1, eval (no.,total): ( 1,  1): new dev = 7.26685e+09
7266852129 :  -1168.7431626 -1616.9349784     0.4000966 19011.7485253  4563.0770122    -0.3838582 
  It.   2, fac=           1, eval (no.,total): ( 1,  2): new dev = 3.5306e+09
3530597333 :  -4.167425e+02 -2.348539e+02 -2.149414e-01  1.844411e+04  3.360758e+03  9.578533e-02 
  It.   3, fac=           1, eval (no.,total): ( 1,  3): new dev = 3.35028e+09
3350280922 :  -5.138977e+02 -4.222131e+02 -8.824859e-02  1.855449e+04  3.492002e+03 -3.238426e-02 
  It.   4, fac=           1, eval (no.,total): ( 1,  4): new dev = 3.34919e+09
3349193215 :  -5.214855e+02 -4.098074e+02 -8.494775e-02  1.855594e+04  3.477102e+03 -3.182165e-02 
  It.   5, fac=           1, eval (no.,total): ( 1,  5): new dev = 3.34919e+09
3349187541 :  -5.228389e+02 -4.092771e+02 -8.434369e-02  1.855681e+04  3.476902e+03 -3.231738e-02 
  It.   6, fac=           1, eval (no.,total): ( 1,  6): new dev = 3.34919e+09
3349187436 :  -5.230377e+02 -4.091178e+02 -8.426445e-02  1.855689e+04  3.476803e+03 -3.233999e-02 
  It.   7, fac=           1, eval (no.,total): ( 1,  7): new dev = 3.34919e+09
3349187433 :  -5.230732e+02 -4.090974e+02 -8.424572e-02  1.855691e+04  3.476794e+03 -3.234809e-02 
Warning message:
number of iterations exceeded maximum of 7 
> 
> ##############################
> ## Linked exp. rates
> ##############################
> 
> model_exp_linkedrates <- initModel(mod_type = "spec", 
+ specpar=list(c(18000, 3200, -.1)), specdisp = TRUE,
+ specdispindex = list(c(1,1), c(1,2), c(1,3)),
+ specdisppar=list(c(600,1/20), c(400), c(.1)),
+ specref=53, specfun="gaus",  parmufunc = "exp",
+ nupow=5,
+ title = "Exponential parameterization of time dep., linked rates")
> 
> res_model_exp_linkedrates <- fitModel(data = list(psi_1_sampled), 
+ modspec = list(model_exp_linkedrates), 
+ opt=specopt(iter=5, linrange = 20, residplot=TRUE,
+ makeps = "explinked", nospectra = TRUE, 
+ selectedspectra = seq(1, psi_1_sampled@nt, by=7),
+ xlab = "time", ylab = "wavelength")) 
4379080143 :    600.00     0.05   400.00     0.10 18000.00  3200.00    -0.10 
  It.   1, fac=           1, eval (no.,total): ( 1,  1): new dev = 1.93015e+09
1930153980 :   8.466580e+02  7.380028e-02  7.453970e+02  3.801354e-02  1.819694e+04  3.207179e+03 -8.670550e-02 
  It.   2, fac=           1, eval (no.,total): ( 1,  2): new dev = 1.89445e+09
1894450759 :   9.907243e+02  7.194364e-02  7.024222e+02 -2.927466e-02  1.818120e+04  3.172968e+03 -7.615413e-02 
  It.   3, fac=           1, eval (no.,total): ( 1,  3): new dev = 1.89421e+09
1894213947 :   9.811582e+02  7.226185e-02  6.863089e+02 -1.832765e-02  1.818319e+04  3.175024e+03 -7.807477e-02 
  It.   4, fac=           1, eval (no.,total): ( 1,  4): new dev = 1.89421e+09
1894213348 :   9.817587e+02  7.226012e-02  6.861751e+02 -1.868147e-02  1.818309e+04  3.174914e+03 -7.801850e-02 
  It.   5, fac=           1, eval (no.,total): ( 1,  5): new dev = 1.89421e+09
1894213346 :   9.817428e+02  7.226209e-02  6.861435e+02 -1.865167e-02  1.818310e+04  3.174924e+03 -7.802679e-02 
Warning message:
number of iterations exceeded maximum of 5 
> 
